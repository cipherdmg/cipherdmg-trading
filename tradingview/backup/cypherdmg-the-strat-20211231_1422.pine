//@version=5
// ||###################################################################################||
// ||                                                                                   ||
// || The Strat                                                                         ||
// || What are the 1s, 2s, & 3s                                                         ||
// ||                                                                                   ||
// || 1.  Labeled as 1) An inside bar which is defined as consolidation, there has not  ||
// ||     been a new high or low                                                        ||
// ||                                                                                   ||
// || 2. Labeled as 2) A bar that took out a previous high or low this is the bar we    ||
// ||    look to be trading as it is a directional move                                 ||
// ||                                                                                   ||
// || 3. Labeled as 3) A bar that took out the previous bars high AND previous bars low.||
// ||                                                                                   ||
// ||                                                                                   ||
// ||                                                                                   ||
// || 1. Inside Bar Reversals                                                           ||
// ||    Inside bar reversals are one of the easiest to trade.   This is because they   ||
// ||    are simple to scan for and recongnize.                                         ||
// ||    When looking to trade inside bar reverssal all you have to do is scan for an   ||
// ||    inside bar!                                                                    ||
// ||                                                                                   ||
// || 2. 2-2 Reversal                                                                   ||
// ||    A normal 2-2 reversal is going to be harder to find and trade solely because   ||
// ||    it is a 2 candle pattern.  When looking to trade 2-2 reversals you want to look||
// ||    for candles that are 2 U (took previous high) and red or 2D (took previous low)||
// ||    and green.                                                                     ||
// ||    This is the case because we know an enry into a 2-2 reversal to the upside is  ||
// ||    the previous bars high, so if we close green we will be more likely to reverse ||
// ||    as we are closer to that candle's high and visa versa for a 2-2 reversal to the||
// ||    downside.                                                                      ||
// ||                                                                                   ||
// ||                                                                                   ||
// ||  3-2-2 Reversals
// ||  A 3-2-2 reversal is going to be easier to scan for as it is a 3 candle pattern   ||
// ||  meaning we can scan for the first 2 and trade the 3rd.  When looking to trade    ||
// ||  3-2-2 reversals you want to trade them the exact same way as a normal 2-2!       ||
// ||                                                                                   ||
// ||                                                                                   ||
// || https://www.tradingview.com/pine-script-docs/en/v5/essential/Colors.html
// || https://www.tradingview.com/script/PWJRC2Nt-Strat-Assistant/
// || Pine Tips:
// || Colors:
// ||       color.aqua, color.black, color.blue, color.fuchsia, color.gray, color.green ||
// ||       color.lime, color.maroon, color.navy, color.olive, color.orange             ||
// ||       color.purple, color.red, color.silver, color.teal, color.white, color.yellow||
// ||                                                                                   ||
// ||                                                                                   ||
// ||                                                                                   ||
// ||Pivit Machine Gun: Best time to play is at exhaustion risk when you are at all time
// ||hights and all time lows                                                                          ||
// ||                                                                                   ||

// ||###################################################################################||

//strategy(title="The Strat", shorttitle="The Strat", max_labels_count = 500, overlay=true, initial_capital=100000,currency =currency.USD, default_qty_type=strategy.fixed, default_qty_value=1,commission_type=strategy.commission.cash_per_order,  pyramiding=1, commission_value=5.50, slippage =5, margin_long=100, margin_short=100)
indicator(title="The Strat", shorttitle="The Strat", max_labels_count = 500, overlay=true)


DojiSize = input.float(0.05, minval=0.01, title='Doji size')
maLength = input.int(5, minval=1, title="Moving Average Length")

bullishColor = input.color(color.green, title='Bullish color', group='Colors')
bearishColor = input.color(color.red, title='Bearish color', group='Colors')
insideColor = input.color(color.yellow, title='Bearish color', group='Colors')
tfTableOpacity = input.int(80, title='Multi time frame table opacity', group='Colors')
isTfEnabled = input.bool(true, title='Enabled', group='Time frame continuation')
usePreviousClose = input.bool(false, title='Use previous close', group='Time frame continuation')

tfa1 = input.timeframe('15', title='Time Frame 1', group='Time frame continuation')
tfa2 = input.timeframe('30', title='Time Frame 2', group='Time frame continuation')
tfa3 = input.timeframe('60', title='Time Frame 3', group='Time frame continuation')
tfa4 = input.timeframe('D', title='Time Frame 4', group='Time frame continuation')
tfa5 = input.timeframe('W', title='Time Frame 5', group='Time frame continuation')
tfa6 = input.timeframe('1M', title='Time Frame 6', group='Time frame continuation')
tfa7 = input.timeframe('3M', title='Time Frame 7', group='Time frame continuation')


//##################################################################################################
//Functions
//##################################################################################################


// @function Calculates the all-time high of a series.
// @param val Series to use (`high` is used if no argument is supplied).
// @returns The all-time high for the series.
allTimeHi(float val = high) =>
    var float ath = val
    ath := math.max(ath, val)


// @function Calculates the all-time low of a series.
// @param val Series to use (`low` is used if no argument is supplied).
// @returns The all-time low for the series.
allTimeLow(float val = low) =>
    var float atl = val
    atl := math.min(atl, val)

// @function The given candle is up where the open is less then the close
// @param val Series to use (`high` is used if no argument is supplied).
// @returns The all-time high for the series.
isGreenCandle(int idx) =>
    open[idx] < close[idx]

// @function The given candle is down where the open is greater then the close
// @param val Series to use (`high` is used if no argument is supplied).
// @returns The all-time high for the series.
isRedCandle(int idx) =>
    open[idx] >= close[idx]

//1
//@function Entire Candle wick to wick is inside the previous candle.
//It means its consolidation on a smaller timeframe  We do not want to trade things on a 1 because it has Not picked its direction.
//@returns
isInsideCandle(int idx) =>
    high[idx] <= high[idx + 1] and low[idx] >= low[idx + 1]

//3
//@function Candle engulfs the previous candle and is typically the larges bar.
//Most commonly 3s occur after 1
//@return
isOutsideCandle(int idx) =>
    high[idx] > high[idx + 1] and low[idx] < low[idx + 1]


//2
//@function  Down Directional Candle which broke the previous candle's low
isTwoDownCandle(int idx) =>
    low[idx] < low[idx + 1] and not (high[idx] > high[idx + 1])


//2
//@function Up Directional Candle which broke the previous candle's low
isTwoUpCandle(int idx) =>
    high[idx] > high[idx + 1] and not (low[idx] < low[idx + 1])


// reusable bar identifier functions for series
isInsideCandleSeries(highSeries, lowSeries) =>
    highSeries[0] <= highSeries[1] and lowSeries[0] >= lowSeries[1]

isOutsideCandleSeries(highSeries, lowSeries) =>
    highSeries[0] > highSeries[1] and lowSeries[0] < lowSeries[1]



//https://commodity.com/technical-analysis/doji/
//The doji is a transitional candlestick formation, signifying equality or indecision between bulls and bears.
// @function Determine if the given candle is a Doji Candle
// @param index
// @returns if the given candle is a DOJI candle
isDojiCandle(int idx) =>
    math.abs(open[idx] - close[idx]) <= (high[idx] - low[idx]) * DojiSize


//https://commodity.com/technical-analysis/evening-star
//The Evening Star pattern is viewed as a bearish reversal pattern in technical analysis. It usually occurs at the top of an uptrend.
//The first part of an Evening Star reversal pattern is a large bullish green candle. On the first day, bulls are in charge – new highs are usually made.
//The second day begins with a bullish gap up.
//The most significant candlestick occurs on Day 3. It begins with a gap down (a bearish signal) and bears are able to press prices even further downward, often eliminating the gains seen on Day 1.
isEveningStar(int idx) =>
    close[idx + 2] > open[idx + 2] and math.min(open[idx + 1], close[idx + 1]) > close[idx + 2] and open[idx] < math.min(open[idx + 1], close[idx + 1]) and close[idx] < open[idx]


//https://commodity.com/technical-analysis/morning-star
//The Morning Star Pattern is viewed as a bullish reversal pattern, usually occurring at the bottom of a downtrend. The pattern consists of three candlesticks:
//morning star candlestick chart pattern Large Bearish Candle (Day 1) Small Bullish or Bearish Candle (Day 2) Large Bullish Candle (Day 3)
isMorningStar(int idx) =>
    close[idx + 2] < open[idx + 2] and math.max(open[idx + 1], close[idx + 1]) < close[idx + 2] and open[idx] > math.max(open[idx + 1], close[idx + 1]) and close[idx] > open[idx]


//https://commodity.com/technical-analysis/shooting-star/
//The Shooting Star candlestick formation is viewed as a bearish reversal candlestick pattern that typically occurs at the top of uptrends.
//The Shooting formation is created when the open, low, and close are roughly the same price.
shootingStar(int idx) =>
    open[idx + 1] < close[idx + 1] and open[idx] > close[idx + 1] and high[idx] - math.max(open[idx], close[idx]) >= math.abs(open[idx] - close[idx]) * 3 and math.min(close[idx], open[idx]) - low[idx] <= math.abs(open[idx] - close[idx])

//Hanging Man vs Hammer Candlestick Patterns The primary difference between the Hanging Man pattern and the Hammer Candlestick pattern is that the former is bullish and the latter is bearish. That’s because the Hanging Man appears at the top of uptrends while the Hammer appears at the bottom of downtrends.

//https://commodity.com/technical-analysis/hammer/
//The Hammer candlestick formation is viewed as a bullish reversal candlestick pattern that mainly occurs at the bottom of downtrends.
//The Hammer formation is created when the open, high, and close prices are roughly the same. Also, there is a long lower shadow that’s twice the length as the real body.
hammer(int idx) =>
    high[idx] - low[idx] > 3 * (open[idx] - close[idx]) and (close[idx] - low[idx]) / (.001 + high[idx] - low[idx]) > 0.6 and (open[idx] - low[idx]) / (.001 + high[idx] - low[idx]) > 0.6


//https://commodity.com/technical-analysis/inverted-hammer/
//The Inverted Hammer candlestick formation occurs mainly at the bottom of downtrends and can act as a warning of a potential bullish reversal pattern.
//The Inverted Hammer formation is created when the open, low, and close are roughly the same price. Also, there is a long upper shadow which should be at least twice the length of the real body.
invertedHammer(int idx) =>
    high[idx] - low[idx] > 3 * (open[idx] - close[idx]) and (high[idx] - close[idx]) / (.001 + high[idx] - low[idx]) > 0.6 and (high[idx] - open[idx]) / (.001 + high[idx] - low[idx]) > 0.6

//https://commodity.com/technical-analysis/hanging-man/
//The Hanging Man candlestick pattern, as one could predict from the name, is viewed as a bearish reversal pattern and appears at the top of up trends
hangingMan(int idx) =>
    high[idx] - low[idx] > 4 * (open[idx] - close[idx]) and (close[idx] - low[idx]) / (.001 + high[idx] - low[idx]) >= 0.75 and (open[idx] - low[idx]) / (.001 + high[idx] - low[idx]) >= 0.75 and high[idx + 1] < open[idx] and high[idx + 2] < open[idx]


//https://commodity.com/technical-analysis/harami/
//The Harami Candlestick Pattern is considered a trend reversal pattern that can either be bullish or bearish, depending on the direction of the price action.
//A Harami pattern can be either bullish or bearish, depending on the color of its candles
bearishHarami(int idx) =>
    close[idx + 1] > open[idx + 1] and open[idx] > close[idx] and open[idx] <= close[idx + 1] and open[idx + 1] <= close[idx] and open[idx] - close[idx] < close[idx + 1] - open[idx + 1]

bullishHarami(int idx) =>
    open[idx + 1] > close[idx + 1] and close[idx] > open[idx] and close[idx] <= open[idx + 1] and close[idx + 1] <= open[idx] and close[idx] - open[idx] < open[idx + 1] - close[idx + 1]


//https://commodity.com/technical-analysis/bearish-engulfing/
//The Bearish Engulfing Candlestick Pattern is considered to be a bearish reversal pattern, usually occurring at the top of an uptrend.
bearishEngulfing(int idx) =>
    close[idx + 1] > open[idx + 1] and open[idx] > close[idx] and open[idx] >= close[idx + 1] and open[idx + 1] >= close[idx] and open[idx] - close[idx] > close[idx + 1] - open[idx + 1]

//https://commodity.com/technical-analysis/bullish-engulfing/
//The Bullish Engulfing Candlestick Pattern is a bullish reversal pattern, usually occurring at the bottom of a downtrend.
bullishEngulfing(int idx) =>
    open[idx + 1] > close[idx + 1] and close[idx] > open[idx] and close[idx] >= open[idx + 1] and close[idx + 1] >= open[idx] and close[idx] - open[idx] > open[idx + 1] - close[idx + 1]

//https://commodity.com/technical-analysis/piercing-pattern/
//The Piercing Pattern is viewed as a bullish candlestick reversal pattern, similar to the Bullish Engulfing Pattern.
piercingLine(int idx) =>
    close[idx + 1] < open[idx + 1] and open[idx] < low[idx + 1] and close[idx] > close[idx + 1] + (open[idx + 1] - close[idx + 1]) / 2 and close[idx] < open[idx + 1]

//https://www.tradingsetupsreview.com/belt-hold-candlestick-pattern-trading-strategies-guide/
bullishBelt(int idx) =>
    lower = ta.lowest(10)[idx + 1]
    low[idx] == open[idx] and open[idx] < lower and open[idx] < close[idx] and close[idx] > (high[idx + 1] - low[idx + 1]) / 2 + low[idx + 1]

//The Bullish Kicker signal often occurs after a major surprise in the news that is announced before or after market hours. Something drastic has happened,
//causing a great shift in investor sentiment, and a reversal will inevitably follow. The larger the gap between the two candles, the more significant the signal.
bullisnKicker(int idx) =>
    open[idx + 1] > close[idx + 1] and open[idx] >= open[idx + 1] and close[idx] > open[idx]


//Bearish Kickers often appear after a startling news event that causes an abrupt change in investor sentiment before or after market hours
bearishKicker(int idx) =>
    open[idx + 1] < close[idx + 1] and open[idx] <= open[idx + 1] and close[idx] <= open[idx]


//https://commodity.com/technical-analysis/dark-cloud-cover/
//Dark Cloud Cover is a bearish candlestick reversal pattern, similar to the Bearish Engulfing Pattern.
darknCloudCover(int idx) =>
    close[idx + 1] > open[idx + 1] and (close[idx + 1] + open[idx + 1]) / 2 > close[idx] and open[idx] > close[idx] and open[idx] > close[idx + 1] and close[idx] > open[idx + 1] and (open[idx] - close[idx]) / (.001 + high[idx] - low[idx]) > 0.6

///////////////////////////////////////////////
// END: user input
///////////////////////////////////////////////

// FULL TIME FRAME CONTINUITY CODE:
//reusable function for getting detail on the security
getSecurityByTimeFrame(timeFrame) =>
    [openValue, closeValue, highValue, lowValue, timeValue] = request.security(syminfo.tickerid, timeFrame, [open, close, high, low, time])
    [openValue, closeValue, highValue, lowValue, timeValue]


///////////////////////////////////////////////
// END: Functions & Logic
///////////////////////////////////////////////


//##################################################################################################
//MACD
//##################################################################################################
//Standard MACD
fast = 12, slow = 26
fastMA = ta.ema(close, fast)
slowMA = ta.ema(close, slow)

macd = fastMA - slowMA
signal = ta.sma(macd, 9)

percentage_macd =  (macd / slowMA) * 100
percentage_hist = percentage_macd - signal
//macd := 100*(fastMA - slowMA)/slowMA

//plot(percentage_hist, color = color.lime)
// plot(signal, color = color.orange)



// //##################################################################################################
// //Candlestick Patterns for debugging
// //##################################################################################################
// //Neutral
// plotchar(series=isDojiCandle(0), title='Doji', location=location.abovebar, color=color.new(color.white, 0), text='Doji')

// //Neutral
// plotshape(series=isInsideCandle(0), title='Inside', location=location.abovebar, color=color.new(color.white, 0), style=shape.arrowdown, text='Inside')


// //Bearish
// plotshape(series=isEveningStar(0), title='Evening Star', color=color.new(color.red, 0), style=shape.arrowdown, text='Evening\nStar')

// //Bearish
// plotshape(series=shootingStar(0), title='Shooting Star', color=color.new(color.red, 0), style=shape.arrowdown, text='Shooting\nStar')

// //bearish reversal pattern and appears at the top of up trends
// plotshape(series=hangingMan(0), title='Hanging Man', color=color.new(color.red, 0), style=shape.arrowdown, text='Hanging\nMan')

// //Bearish typically occurred at the top of a up trend
// plotshape(series=bearishHarami(0), title='Bearish Harami', color=color.new(color.red, 0), style=shape.arrowdown, text='Bearish\nHarami')

// //bearish reversal pattern, usually occurring at the top of an uptrend.
// plotshape(series=bearishEngulfing(0), title='Bearish Engulfing', color=color.new(color.red, 0), style=shape.arrowdown, text='Bearish\nEngulfing')

// //bearish reversal gap
// plotshape(series=bearishKicker(0), title='Bearish Kicker', color=color.new(color.red, 0), style=shape.arrowdown, text='Bearish\nKicker')

// //bearish candlestick reversal pattern
// plotshape(series=darknCloudCover(0), title='Dark Cloud Cover', color=color.new(color.red, 0), style=shape.arrowdown, text='Dark\nCloudCover')


// //Bullish
// plotshape(series=isMorningStar(0), title='Morning Star', location=location.belowbar, color=color.new(color.lime, 0), style=shape.arrowup, text='Morning\nStar')

// //Bullish typically occurred at the bottom of a down trend
// plotshape(series=hammer(0), title='Hammer', location=location.belowbar, color=color.new(color.white, 0), style=shape.diamond, text='H')

// //Bullish typically occurred at the bottom of a down trend
// plotshape(series=invertedHamme(0), title='Inverted Hammer', location=location.belowbar, color=color.new(color.white, 0), style=shape.diamond, text='IH')

// //Bullish typically occurred at the bottom of a down trend
// plotshape(series=bullishHarami(0), title='Bullish Harami', location=location.belowbar, color=color.new(color.lime, 0), style=shape.arrowup, text='Bullish\nHarami')

// //bullish reversal pattern, usually occurring at the bottom of a downtrend.
// plotshape(series=bullishEngulfing(0), title='Bullish Engulfing', location=location.belowbar, color=color.new(color.lime, 0), style=shape.arrowup, text='Bullish\nEngulfling')

// //bullish candlestick reversal pattern, similar to the Bullish Engulfing Pattern.
// plotshape(series=piercingLine(0), title='Piercing Line', location=location.belowbar, color=color.new(color.lime, 0), style=shape.arrowup, text='Piercing\nLine')

// //bullish
// plotshape(series=bullishBelt(0), title='Bullish Belt', location=location.belowbar, color=color.new(color.lime, 0), style=shape.arrowup, text='Bullish\nBelt')

// //bullish reversal gap
// plotshape(series=bullisnKicker(0), title='Bullish Kicker', location=location.belowbar, color=color.new(color.lime, 0), style=shape.arrowup, text='Bullish\nKicker')


//##################################################################################################
//Plot the Moving Average
//##################################################################################################

//5 tick moving average to smooth the events
smooth_moving_average = (open + high + low + close) / 4

smma = ta.sma(smooth_moving_average, maLength)
plot(series=smma, title="Moving Average", color=color.yellow, linewidth=2, style=plot.style_line)

//##################################################################################################
//Highlight background with transparent red and green to represent overbought and oversold
//##################################################################################################
//Plot the Relative Strength Index (RSI) when its over 70 and under 30
rsi_len = input.int(14, minval=1, title="RSI Length")
rsi_src = input(close, "RSI Source")
rsi_min = input.int(30, minval=1, title="RSI Minimum Threshold")
rsi_max = input.int(70, minval=1, title="RSI Maximum Threshold")

rsi = ta.rsi(rsi_src, rsi_len)
rsi_color = rsi > rsi_max ? color.new(color.red,80)  : rsi < rsi_min ? color.new(color.green, 80) : na
//rsi_color = rsi > rsi_max ? color.rgb(183, 28, 28)  : rsi < rsi_min ? color.rgb(0, 77, 64) : na

bgcolor(color=rsi_color, offset=0, editable=true, title="RSI")



//https://www.tradingview.com/pine-script-docs/en/v5/concepts/Bar_states.html?highlight=bar%20states
///https://www.tradingview.com/pine-script-docs/en/v5/concepts/Bar_states.html?highlight=isrealtime

//##################################################################################################
//In Force Patters - In force Patters are paters that hav been triggered but which you may still
//                   be able to enter on a pull back to the entry point
//
//The trade setup will allow you to find the pattern at the end of the tape.
//Refer to the cheatsheet for actual trade setups
//##################################################################################################



//##################################################################################################
//Lable Debugging
//##################################################################################################
//Check if we are live or if its the end of the day
// isLive = time(timeframe.period, "0930-1600")

stateText() =>
    string txt = ""
    txt += barstate.isfirst     ? "isfirst\n"     : ""
    txt += barstate.islast      ? "islast\n"      : ""
    txt += barstate.ishistory   ? "ishistory\n"   : ""
    txt += barstate.isrealtime  ? "isrealtime\n"  : ""
    txt += barstate.isnew       ? "isnew\n"       : ""
    txt += barstate.isconfirmed ? "isconfirmed\n" : ""
    txt += barstate.islastconfirmedhistory ? "islastconfirmedhistory\n" : ""


labelColor = switch
    barstate.isfirst                => color.fuchsia
    barstate.islastconfirmedhistory => color.gray
    barstate.ishistory              => color.silver
    barstate.isconfirmed            => color.orange
    barstate.isnew                  => color.red
    => color.yellow

//label.new(bar_index, na, stateText(), yloc = yloc.abovebar, color = labelColor)





//##################################################################################################
//The Strat Combinations
//


//##################################################################################################
//Plot the 1, 2U, 2D, 3 Strat Numbering System
//##################################################################################################

// identify 1 candles with identifier below
plotchar(isInsideCandle(0), title='One Bar', char='1', location=location.belowbar, color=color.new(color.new(#F6BE00, 0), 0))

// identify 2 up candle with identifier below and indicator above
plotshape(isTwoUpCandle(0), style=shape.arrowup, title='Two Up Bar Shape', location=location.abovebar, color=color.new(color.green, 0))
plotchar(isTwoUpCandle(0), title='Two Up Bar', char='2', location=location.belowbar, color=color.new(color.green, 0))

// identify 2 down candle with identifier below and indicator above
plotshape(isTwoDownCandle(0), style=shape.arrowdown, title='Two Bar Shape', location=location.abovebar, color=color.new(color.red, 0))
plotchar(isTwoDownCandle(0), title='Two Down Bar', char='2', location=location.belowbar, color=color.new(color.red, 0))

// identify 3 candle with indentifier below
plotchar(isOutsideCandle(0), title='Three Bar', char='3', location=location.belowbar, color=color.new(color.fuchsia, 0))

//##################################################################################################
// change bar color
//##################################################################################################
// barcolor(color=getBarColor())
_isInsideCandle = isInsideCandle(0)
_isOutsideCandle = isOutsideCandle(0)
_isGreenCandle = isGreenCandle(0)
_isRedCandle = isRedCandle(0)

barcolor(color=_isInsideCandle? color.new(#F6BE00, 0) : _isOutsideCandle? color.fuchsia : _isGreenCandle? color.green : _isRedCandle? color.red : na,offset=0,editable=true)


//##################################################################################################
//FTFC
//



cdayhigh = request.security(syminfo.tickerid, 'D', high)
cdaylow = request.security(syminfo.tickerid, 'D', low)
dAtr = request.security(syminfo.tickerid, 'D', ta.atr(14), lookahead=barmerge.lookahead_on)

var table tcTable = table.new(position=position.top_right, columns = 9, rows = 2, border_width=3)


// get open, close, high, and low series for various time frames
[open15Value, close15Value, high15Value, low15Value, time15Value] = getSecurityByTimeFrame(tfa1)
[open30Value, close30Value, high30Value, low30Value, time30Value] = getSecurityByTimeFrame(tfa2)
[open60Value, close60Value, highHourValue, lowHourValue, timeHourValue] = getSecurityByTimeFrame(tfa3)
[openDayValue, closeDayValue, highDayValue, lowDayValue, timeDayValue] = getSecurityByTimeFrame(tfa4)
[openWeekValue, closeWeekValue, highWeekValue, lowWeekValue, timeWeekValue] = getSecurityByTimeFrame(tfa5)
[openMonthValue, closeMonthValue, highMonthValue, lowMonthValue, timeMonthValue] = getSecurityByTimeFrame(tfa6)
[openQuarterValue, closeQuarterValue, highQuarterValue, lowQuarterValue, timeQuarterValue] = getSecurityByTimeFrame(tfa7)


if barstate.islast and isTfEnabled
    tfa1Bullish = open15Value[0] <= close15Value[0]
    tfa2Bullish = open30Value[0] <= close30Value[0]
    tfa3Bullish = open60Value[0] <= close60Value[0]
    tfa4Bullish = openDayValue[0] <= closeDayValue[0]
    tfa5Bullish = openWeekValue[0] <= closeWeekValue[0]
    tfa6Bullish = openMonthValue[0] <= closeMonthValue[0]
	tfa7Bullish = openQuarterValue[0] <= closeQuarterValue[0]

    tfa1Chg = (close15Value - open15Value) / open15Value * 100.0
    tfa1Color = tfa1Bullish ? bullishColor : bearishColor

    tfa2Chg = (close30Value - open30Value) / open30Value * 100.0
    tfa2Color = tfa2Bullish ? bullishColor : bearishColor

    tfa3Chg = (close60Value - open60Value) / open60Value * 100.0
    tfa3Color = tfa3Bullish ? bullishColor : bearishColor

    tfa4Chg = (closeDayValue - openDayValue) / openDayValue * 100.0
    tfa4Color = tfa4Bullish ? bullishColor : bearishColor

    tfa5Chg = (closeWeekValue - openWeekValue) / openWeekValue * 100.0
    tfa5Color = tfa5Bullish ? bullishColor : bearishColor

    tfa6Chg = (closeMonthValue - openMonthValue) / openMonthValue * 100.0
    tfa6Color = tfa6Bullish ? bullishColor : bearishColor

	tfa7Chg = (closeQuarterValue - openQuarterValue) / openQuarterValue * 100.0
    tfa7Color = tfa7Bullish ? bullishColor : bearishColor

    table.cell(tcTable, 0, 0, tfa1 + '\n' + str.tostring(tfa1Chg, '#.##') + '%', bgcolor=color.new(tfa1Color, tfTableOpacity), text_color=tfa1Color, text_size=size.auto, width=0)
    //table.cell(tcTable, 1, 0, tfa2 + '\n' + str.tostring(tfa2Chg, '#.##') + '%', bgcolor=color.new(tfa2Color, tfTableOpacity), text_color=tfa2Color, text_size=size.auto, width=0)
    table.cell(tcTable, 1, 0, tfa2 + '\n' + str.tostring(closeDayValue, '#.##') + ' ' + str.tostring(openDayValue, '#.##') , bgcolor=color.new(tfa2Color, tfTableOpacity), text_color=tfa2Color, text_size=size.auto, width=0)
    table.cell(tcTable, 2, 0, tfa3 + '\n' + str.tostring(tfa3Chg, '#.##') + '%', bgcolor=color.new(tfa3Color, tfTableOpacity), text_color=tfa3Color, text_size=size.auto, width=0)
    table.cell(tcTable, 3, 0, tfa4 + '\n' + str.tostring(tfa4Chg, '#.##') + '%', bgcolor=color.new(tfa4Color, tfTableOpacity), text_color=tfa4Color, text_size=size.auto, width=0)
    table.cell(tcTable, 4, 0, tfa5 + '\n' + str.tostring(tfa5Chg, '#.##') + '%', bgcolor=color.new(tfa5Color, tfTableOpacity), text_color=tfa5Color, text_size=size.auto, width=0)
    table.cell(tcTable, 5, 0, tfa6 + '\n' + str.tostring(tfa6Chg, '#.##') + '%', bgcolor=color.new(tfa6Color, tfTableOpacity), text_color=tfa6Color, text_size=size.auto, width=0)
	table.cell(tcTable, 6, 0, tfa7 + '\n' + str.tostring(tfa7Chg, '#.##') + '%', bgcolor=color.new(tfa7Color, tfTableOpacity), text_color=tfa7Color, text_size=size.auto, width=0)
    table.cell(tcTable, 7, 0, 'DTR' + '\n' + str.tostring(cdayhigh - cdaylow, '#.##'), bgcolor=color.new(color.gray, tfTableOpacity), text_color=color.white, text_size=size.auto, width=0)
    table.cell(tcTable, 8, 0, 'ATR' + '\n' + str.tostring(dAtr, '#.##'), bgcolor=color.new(color.gray, tfTableOpacity), text_color=color.white, text_size=size.auto, width=0)

